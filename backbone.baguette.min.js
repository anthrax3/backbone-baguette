(function(e){if(typeof e.Backbone=="undefined"||typeof e._=="undefined")throw new Error("Backbone & underscore required!");var t=e.Backbone,n=e._;if(n.isUndefined(n.isPlainObject)){var r=function(e){return n.isObject(e)?e.constructor==Object:!1};n.isPlainObject=r}t.Baguette={};var i=function(e,t){return Handlebars.compile(e)(t)};t.Baguette.Templating=i;var s=["noBind","tpl","modelView","templating","nestedViews","loaderView","loader"],o=function(e){n.each(s,function(t){n.isUndefined(e.options[t])||(e[t]=e.options[t])})},u=function(e){delete e.el,delete e.tagName,delete e.tagName,delete e.id,delete e.className,delete e.attributes};t.Baguette.BaseView=t.View;var a=t.View.extend({className:"loader"});t.Baguette.LoaderView=a;var f=t.View.extend({loader:!1,initialize:function(e){if(this.loader){var r;n.isUndefined(this.loaderView)?r=t.Baguette.LoaderView:r=this.loaderView,n.isUndefined(this.model)?n.isUndefined(this.collection)||(instOpts={collection:this.collection,ref:this.collection}):instOpts={model:this.model,ref:this.model},this.loaderViewInstance=new r(instOpts),this.listenTo(instOpts.ref,"request",this.renderLoader)}},renderLoader:function(){this.clean(),this.$el.html(this.loaderViewInstance.render().$el)}});t.Baguette.LoadableView=f;var l=f.extend({tpl:"",noBind:!1,templating:t.Baguette.Templating,initialize:function(e){o(this),l.__super__.initialize.call(this,e),this.noModel=!1,n.isUndefined(this.model)&&(this.noModel=!0),!this.noBind&&!this.noModel&&this.listenTo(this.model,"change",this.render)},render:function(){return this.noModel?this.$el.html(this.tpl):n.isUndefined(this.compiledTemplate)?this.$el.html(this.templating(this.tpl,this.model.toJSON())):this.$el.html(this.compiledTemplate(this.model.toJSON())),this},clean:function(){return this.$el.empty(),this}});t.Baguette.ModelView=l;var c=l.extend({_views:[],nestedViews:{},initialize:function(e){c.__super__.initialize.call(this,e),this._views=[]},renderNestedViews:function(){var e=this,t=n.clone(this.options);return u(t),n.each(this.nestedViews,function(r,i){t.collection=e.options.collection,t.model=e.options.model;var s=!0,o=!0,u=e.$el.find(i);if(u.length===0)throw new Error("Your selector "+i+" didn't match anything!");if(n.isPlainObject(r)){if(n.isUndefined(r.view))throw new Error('Object for selector must contains a "view" attribute boy!');n.isUndefined(r.render)||(o=r.render);var a=r;r=r.view,n.isUndefined(a.setElement)||(s=a.setElement),n.isUndefined(a.modelAttribute)?n.isUndefined(a.collectionAttribute)||(delete t.model,n.extend(t,{collection:e.model.get(a.collectionAttribute)})):(delete t.collection,n.extend(t,{model:e.model.get(a.modelAttribute)}))}n.isUndefined(r.prototype.modelView)||delete t.model;var f=new r(t);s?f.setElement(u):f.$el.appendTo(u),o&&f.render(),e._views.push(f)}),this},render:function(){return this.clean(),c.__super__.render.call(this),this.renderNestedViews(),this},clean:function(){return c.__super__.clean.call(this),n.each(this._views,function(e){e.remove()}),this._views=[],this}});t.Baguette.CompositeView=c;var h=f.extend({noBind:!1,modelView:t.Baguette.ModelView,_views:[],initialize:function(e){o(this),h.__super__.initialize.call(this,e),this._views=[];if(n.isUndefined(this.collection))throw new Error("CollectionView needs a collection!");this.noBind||this.listenTo(this.collection,"add reset remove",this.render)},render:function(){var e=this;this.clean();var r=n.clone(this.options);u(r),delete r.collection;var i=this.modelView;return n.isPlainObject(this.modelView)?(i=t.Baguette.ModelView,n.extend(r,this.modelView)):i=this.modelView,this.collection.each(function(t){n.extend(r,{model:t});var s=new i(r);e.$el.append(s.render().$el),e._views.push(s)}),this},clean:function(){return n.each(this._views,function(e){e.remove()}),this.$el.empty(),this._views=[],this}});return t.Baguette.CollectionView=h,t.Baguette})(this);