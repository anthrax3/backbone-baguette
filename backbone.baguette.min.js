(function(e){typeof define=="function"?define(e):e(Backbone,_)})(function(e,t){if(typeof e=="undefined"||typeof t=="undefined")throw new Error("Backbone & underscore required!");if(t.isUndefined(t.isPlainObject)){var n=function(e){return t.isObject(e)?e.constructor==Object:!1};t.isPlainObject=n}e.Baguette={};var r=function(e,t){return Handlebars.compile(e)(t)};e.Baguette.templating=r;var i=["noBind","tpl","modelView","templating","nestedViews","loaderView","loader"],s=function(e){t.each(i,function(n){t.isUndefined(e.options[n])||(e[n]=e.options[n])})},o=function(e){delete e.el,delete e.tagName,delete e.tagName,delete e.id,delete e.className,delete e.attributes};e.Baguette.BaseView=e.View;var u=e.View.extend({className:"loader",initialize:function(e){var n;return t.isUndefined(this.model)?t.isUndefined(this.collection)||(n=this.collection):n=this.model,this.toListenObj=n,this.listenTo(n,"request",t.bind(this.$el.show,this.$el)),this.listenTo(n,"sync",t.bind(this.$el.hide,this.$el)),this.$el.hide(),this}});e.Baguette.LoaderView=u;var a=e.View.extend({loader:!1,initialize:function(n){if(this.loader){var r;t.isUndefined(this.loaderView)?r=e.Baguette.LoaderView:r=this.loaderView,t.isUndefined(this.model)?t.isUndefined(this.collection)||(instOpts={collection:this.collection,ref:this.collection}):instOpts={model:this.model,ref:this.model},this.loaderViewInstance=new r(instOpts),this.loaderViewInstance.render().$el.appendTo(this.$el),this.listenTo(instOpts.ref,"request",this.clean)}},remove:function(){return!t.isUndefined(this.loaderViewInstance)&&!t.isUndefined(this.loaderViewInstance.remove)&&this.loaderViewInstance.remove(),e.View.prototype.remove.call(this),this}});e.Baguette.LoadableView=a;var f=a.extend({tpl:"",noBind:!1,templating:e.Baguette.templating,loader:!1,initialize:function(e){s(this),f.__super__.initialize.call(this,e),this.noModel=!1,t.isUndefined(this.model)&&(this.noModel=!0),!this.noBind&&!this.noModel&&this.listenTo(this.model,"change",this.render),t.bindAll(this,"clean")},render:function(){return this.clean(),this.noModel?this.clean().$el.html(this.tpl):t.isUndefined(this.compiledTemplate)?this.$el.html(this.templating(this.tpl,this.model.toJSON())):this.$el.html(this.compiledTemplate(this.model.toJSON())),this},clean:function(){return this.$el.empty(),this}});e.Baguette.ModelView=f;var l=f.extend({_views:[],nestedViews:{},initialize:function(e){l.__super__.initialize.call(this,e),this._views=[],t.bindAll(this)},renderNestedViews:function(){var e=this,n=t.clone(this.options);return o(n),t.each(this.nestedViews,function(r,i){n.collection=e.options.collection,n.model=e.options.model;var s=!0,o=!0,u=e.$el.find(i);if(u.length===0)throw new Error("Your selector "+i+" didn't match anything!");if(t.isPlainObject(r)){if(t.isUndefined(r.view))throw new Error('Object for selector must contains a "view" attribute boy!');t.isUndefined(r.render)||(o=r.render);var a=r;r=r.view,t.isUndefined(a.setElement)||(s=a.setElement),t.isUndefined(a.modelAttribute)?t.isUndefined(a.collectionAttribute)||(delete n.model,t.extend(n,{collection:e.model.get(a.collectionAttribute)})):(delete n.collection,t.extend(n,{model:e.model.get(a.modelAttribute)}))}t.isUndefined(r.prototype.modelView)||delete n.model;var f=new r(n);s?f.setElement(u):f.$el.appendTo(u),o&&f.render(),e._views.push(f)}),this},render:function(){return this.clean(),l.__super__.render.call(this),this.renderNestedViews(),this},clean:function(){return l.__super__.clean.call(this),t.each(this._views,function(e){e.remove()}),this._views=[],this}});e.Baguette.CompositeView=l;var c=a.extend({noBind:!1,modelView:e.Baguette.ModelView,_views:[],initialize:function(e){s(this),c.__super__.initialize.call(this,e),this._views=[];if(t.isUndefined(this.collection))throw new Error("CollectionView needs a collection!");this.noBind||this.listenTo(this.collection,"add reset remove",this.render)},render:function(){var n=this;this.clean();var r=t.clone(this.options);o(r),delete r.collection;var i=this.modelView;return t.isPlainObject(this.modelView)?(i=e.Baguette.ModelView,t.extend(r,this.modelView)):i=this.modelView,this.collection.each(function(e){t.extend(r,{model:e});var s=new i(r);n.$el.append(s.render().$el),n._views.push(s)}),this},clean:function(){return t.each(this._views,function(e){e.remove()}),this._views=[],this}});return e.Baguette.CollectionView=c,e.Baguette});