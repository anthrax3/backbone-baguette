(function(){if("undefined"==typeof Backbone||"undefined"==typeof _)throw Error("Backbone & underscore required!");_.isUndefined(_.isPlainObject)&&(_.isPlainObject=function(a){return _.isObject(a)?a.constructor==Object:!1});Backbone.Baguette={};Backbone.Baguette.templating=function(a,b){return Handlebars.compile(a)(b)};var l=["noBind","tpl","modelView","templating","nestedViews"],j=function(a){_.each(l,function(b){_.isUndefined(a.options[b])||(a[b]=a.options[b])})},k=function(a){delete a.el;delete a.tagName;
delete a.tagName;delete a.id;delete a.className;delete a.attributes},f=Backbone.View.extend({templating:Backbone.Baguette.templating,bindings:[],initialize:function(){this.bindings=[];_.bindAll(this,"bindTo","unbindFromAll","clean","destroy")},bindTo:function(a,b,c,e){a.bind(b,c,e);this.bindings.push({model:a,ev:b,callback:c,context:e})},unbindFromAll:function(){_.each(this.bindings,function(a){a.model.unbind(a.ev,a.callback,a.context)});this.bindings=[]},clean:function(){this.$el.empty()},destroy:function(){this.clean();
this.unbindFromAll();this.remove()}});Backbone.Baguette.BaseView=f;var g=f.extend({tpl:"",noBind:!1,initialize:function(a){g.__super__.initialize.call(this,a);j(this);if(_.isUndefined(this.model))throw Error("ModelView needs a model!");this.noBind||this.bindTo(this.model,"change",this.render,this)},render:function(){this.$el.empty().html(this.templating(this.tpl,this.model.toJSON()));return this}});Backbone.Baguette.ModelView=g;var h=g.extend({_views:[],nestedViews:{},initialize:function(a){h.__super__.initialize.call(this,
a);this._views=[];_.bindAll(this,"renderNestedViews")},renderNestedViews:function(){var a=this,b=_.clone(this.options);k(b);_.each(this.nestedViews,function(c,e){var f=!0,h=!0,g=a.$el.find(e);if(0==g.length)throw Error("Your selector "+e+" didn't match anything!");if(_.isPlainObject(c)){if(_.isUndefined(c.view))throw Error("Object for selector must contains view");!_.isUndefined(c.render)&&!1==c.render&&(h=!1);var d=c,c=c.view;_.isUndefined(d.setElement)||(f=d.setElement);_.isUndefined(d.modelAttribute)?
_.isUndefined(d.collectionAttribute)||(delete b.model,_.extend(b,{collection:a.model.get(d.collectionAttribute)})):(delete b.collection,_.extend(b,{model:a.model.get(d.modelAttribute)}))}d=new c(b);f?d.setElement(g):d.$el.appendTo(g);h&&d.render();a._views.push(d)});return this},render:function(){h.__super__.render.call(this);this.renderNestedViews();return this},clean:function(){h.__super__.clean.call(this);_.each(this._views,function(a){_.isUndefined(a.destroy)||a.destroy()});this._views=[]}});
Backbone.Baguette.CompositeModelView=h;var i=f.extend({noBind:!1,modelView:Backbone.Baguette.ModelView,_views:[],initialize:function(a){i.__super__.initialize.call(this,a);j(this);this._views=[];if(_.isUndefined(this.collection))throw Error("CollectionView needs a collection!");this.noBind||this.bindTo(this.collection,"add reset remove",this.render,this)},render:function(){var a=this;this.clean();var b=_.clone(this.options);k(b);delete b.collection;var c=this.modelView;_.isPlainObject(this.modelView)?
(c=Backbone.Baguette.ModelView,_.extend(b,this.modelView)):c=this.modelView;this.collection.each(function(e){_.extend(b,{model:e});e=new c(b);a.$el.append(e.render().$el);a._views.push(e)});return this},clean:function(){i.__super__.clean.call(this);_.each(this._views,function(a){_.isUndefined(a.destroy)||a.destroy()});this._views=[]}});Backbone.Baguette.CollectionView=i;var m=Backbone.sync,f=function(a,b,c){b.trigger("syncing",a,b,c);m(a,b,c)};Backbone.Baguette.sync=f;Backbone.sync=f})();